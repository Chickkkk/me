<!DOCTYPE html><html  lang="zh-CN" class="h-full"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style id="nuxt-ui-colors">@layer base {
  :root {
  --ui-color-primary-50: var(--color-purple-50, oklch(97.7% 0.014 308.299));
  --ui-color-primary-100: var(--color-purple-100, oklch(94.6% 0.033 307.174));
  --ui-color-primary-200: var(--color-purple-200, oklch(90.2% 0.063 306.703));
  --ui-color-primary-300: var(--color-purple-300, oklch(82.7% 0.119 306.383));
  --ui-color-primary-400: var(--color-purple-400, oklch(71.4% 0.203 305.504));
  --ui-color-primary-500: var(--color-purple-500, oklch(62.7% 0.265 303.9));
  --ui-color-primary-600: var(--color-purple-600, oklch(55.8% 0.288 302.321));
  --ui-color-primary-700: var(--color-purple-700, oklch(49.6% 0.265 301.924));
  --ui-color-primary-800: var(--color-purple-800, oklch(43.8% 0.218 303.724));
  --ui-color-primary-900: var(--color-purple-900, oklch(38.1% 0.176 304.987));
  --ui-color-primary-950: var(--color-purple-950, oklch(29.1% 0.149 302.717));
  --ui-color-secondary-50: var(--color-blue-50, oklch(97% 0.014 254.604));
  --ui-color-secondary-100: var(--color-blue-100, oklch(93.2% 0.032 255.585));
  --ui-color-secondary-200: var(--color-blue-200, oklch(88.2% 0.059 254.128));
  --ui-color-secondary-300: var(--color-blue-300, oklch(80.9% 0.105 251.813));
  --ui-color-secondary-400: var(--color-blue-400, oklch(70.7% 0.165 254.624));
  --ui-color-secondary-500: var(--color-blue-500, oklch(62.3% 0.214 259.815));
  --ui-color-secondary-600: var(--color-blue-600, oklch(54.6% 0.245 262.881));
  --ui-color-secondary-700: var(--color-blue-700, oklch(48.8% 0.243 264.376));
  --ui-color-secondary-800: var(--color-blue-800, oklch(42.4% 0.199 265.638));
  --ui-color-secondary-900: var(--color-blue-900, oklch(37.9% 0.146 265.522));
  --ui-color-secondary-950: var(--color-blue-950, oklch(28.2% 0.091 267.935));
  --ui-color-warning-50: var(--color-yellow-50, oklch(98.7% 0.026 102.212));
  --ui-color-warning-100: var(--color-yellow-100, oklch(97.3% 0.071 103.193));
  --ui-color-warning-200: var(--color-yellow-200, oklch(94.5% 0.129 101.54));
  --ui-color-warning-300: var(--color-yellow-300, oklch(90.5% 0.182 98.111));
  --ui-color-warning-400: var(--color-yellow-400, oklch(85.2% 0.199 91.936));
  --ui-color-warning-500: var(--color-yellow-500, oklch(79.5% 0.184 86.047));
  --ui-color-warning-600: var(--color-yellow-600, oklch(68.1% 0.162 75.834));
  --ui-color-warning-700: var(--color-yellow-700, oklch(55.4% 0.135 66.442));
  --ui-color-warning-800: var(--color-yellow-800, oklch(47.6% 0.114 61.907));
  --ui-color-warning-900: var(--color-yellow-900, oklch(42.1% 0.095 57.708));
  --ui-color-warning-950: var(--color-yellow-950, oklch(28.6% 0.066 53.813));
  --ui-color-error-50: var(--color-red-50, oklch(97.1% 0.013 17.38));
  --ui-color-error-100: var(--color-red-100, oklch(93.6% 0.032 17.717));
  --ui-color-error-200: var(--color-red-200, oklch(88.5% 0.062 18.334));
  --ui-color-error-300: var(--color-red-300, oklch(80.8% 0.114 19.571));
  --ui-color-error-400: var(--color-red-400, oklch(70.4% 0.191 22.216));
  --ui-color-error-500: var(--color-red-500, oklch(63.7% 0.237 25.331));
  --ui-color-error-600: var(--color-red-600, oklch(57.7% 0.245 27.325));
  --ui-color-error-700: var(--color-red-700, oklch(50.5% 0.213 27.518));
  --ui-color-error-800: var(--color-red-800, oklch(44.4% 0.177 26.899));
  --ui-color-error-900: var(--color-red-900, oklch(39.6% 0.141 25.723));
  --ui-color-error-950: var(--color-red-950, oklch(25.8% 0.092 26.042));
  --ui-color-neutral-50: var(--color-old-neutral-50, oklch(98.5% 0 0));
  --ui-color-neutral-100: var(--color-old-neutral-100, oklch(97% 0 0));
  --ui-color-neutral-200: var(--color-old-neutral-200, oklch(92.2% 0 0));
  --ui-color-neutral-300: var(--color-old-neutral-300, oklch(87% 0 0));
  --ui-color-neutral-400: var(--color-old-neutral-400, oklch(70.8% 0 0));
  --ui-color-neutral-500: var(--color-old-neutral-500, oklch(55.6% 0 0));
  --ui-color-neutral-600: var(--color-old-neutral-600, oklch(43.9% 0 0));
  --ui-color-neutral-700: var(--color-old-neutral-700, oklch(37.1% 0 0));
  --ui-color-neutral-800: var(--color-old-neutral-800, oklch(26.9% 0 0));
  --ui-color-neutral-900: var(--color-old-neutral-900, oklch(20.5% 0 0));
  --ui-color-neutral-950: var(--color-old-neutral-950, oklch(14.5% 0 0));
  }
  :root, .light {
  --ui-primary: var(--ui-color-primary-500);
  --ui-secondary: var(--ui-color-secondary-500);
  --ui-warning: var(--ui-color-warning-500);
  --ui-error: var(--ui-color-error-500);
  }
  .dark {
  --ui-primary: var(--ui-color-primary-400);
  --ui-secondary: var(--ui-color-secondary-400);
  --ui-warning: var(--ui-color-warning-400);
  --ui-error: var(--ui-color-error-400);
  }
}</style><style>pre code .line{display:block}</style><link rel="stylesheet" href="/_nuxt/entry.D2cyCOem.css" crossorigin><style>@layer components {:where(.i-heroicons\:book-open-solid){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='black' d='M11.25 4.533A9.7 9.7 0 0 0 6 3a9.7 9.7 0 0 0-3.25.555a.75.75 0 0 0-.5.707v14.25a.75.75 0 0 0 1 .707A8.2 8.2 0 0 1 6 18.75c1.995 0 3.823.707 5.25 1.886zm1.5 16.103A8.2 8.2 0 0 1 18 18.75c.966 0 1.89.166 2.75.47a.75.75 0 0 0 1-.708V4.262a.75.75 0 0 0-.5-.707A9.7 9.7 0 0 0 18 3a9.7 9.7 0 0 0-5.25 1.533z'/%3E%3C/svg%3E")}:where(.i-heroicons\:home-20-solid){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' width='20' height='20'%3E%3Cpath fill='black' fill-rule='evenodd' d='M9.293 2.293a1 1 0 0 1 1.414 0l7 7A1 1 0 0 1 17 11h-1v6a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-6H3a1 1 0 0 1-.707-1.707z' clip-rule='evenodd'/%3E%3C/svg%3E")}}</style><link rel="preload" as="fetch" crossorigin="anonymous" href="/blog/202504/understand-proxy-and-reflcet/_payload.json?5753449a-b371-4a7b-929f-a15eaee77566"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BF65wi01.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/COFruHt_.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DX-ezNe7.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CASz48RU.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/jt0VpBhx.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DKjxVvVt.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DJudooAp.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/C7cwSDV9.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/C-TpBiV9.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Cuir1bq8.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/dKHZZxSY.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Cm7Zmu91.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BASRfas6.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CDCwiUT6.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BlNjTtaD.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/D4VocQIK.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/B-Vq70VY.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dyqnt_ZX.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Bjtb3zAz.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/5L0UIu8k.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DCsemwzS.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/B4AM8wwF.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BCGrmOYV.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/QBdxUuXq.js"><link rel="preload" as="fetch" fetchpriority="low" crossorigin="anonymous" href="/_nuxt/builds/meta/5753449a-b371-4a7b-929f-a15eaee77566.json"><link rel="prefetch" as="style" crossorigin href="/_nuxt/index.B1FApBYP.css"><link rel="prefetch" as="script" crossorigin href="/_nuxt/Cd83OVwm.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/CtXrikHL.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/IZArJIk3.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/BJ5eKG0P.js"><script type="module" src="/_nuxt/BF65wi01.js" crossorigin></script><script>"use strict";(()=>{const t=window,e=document.documentElement,c=["dark","light"],n=getStorageValue("localStorage","nuxt-color-mode")||"system";let i=n==="system"?u():n;const r=e.getAttribute("data-color-mode-forced");r&&(i=r),l(i),t["__NUXT_COLOR_MODE__"]={preference:n,value:i,getColorScheme:u,addColorScheme:l,removeColorScheme:d};function l(o){const s=""+o+"",a="";e.classList?e.classList.add(s):e.className+=" "+s,a&&e.setAttribute("data-"+a,o)}function d(o){const s=""+o+"",a="";e.classList?e.classList.remove(s):e.className=e.className.replace(new RegExp(s,"g"),""),a&&e.removeAttribute("data-"+a)}function f(o){return t.matchMedia("(prefers-color-scheme"+o+")")}function u(){if(t.matchMedia&&f("").media!=="not all"){for(const o of c)if(f(":"+o).matches)return o}return"light"}})();function getStorageValue(t,e){switch(t){case"localStorage":return window.localStorage.getItem(e);case"sessionStorage":return window.sessionStorage.getItem(e);case"cookie":return getCookie(e);default:return null}}function getCookie(t){const c=("; "+window.document.cookie).split("; "+t+"=");if(c.length===2)return c.pop()?.split(";").shift()}</script></head><body><div id="__nuxt" class="isolate"><!--[--><!--[--><!--[--><!--[--><!--[--><div class="nuxt-loading-indicator" style="position:fixed;top:0;right:0;left:0;pointer-events:none;width:auto;height:3px;opacity:0;background:repeating-linear-gradient(to right,#00dc82 0%,#34cdfe 50%,#0047e1 100%);background-size:Infinity% auto;transform:scaleX(0%);transform-origin:left;transition:transform 0.1s, height 0.4s, opacity 0.4s;z-index:999999;"></div><div style="" class="limit fixed top-0 right-0 left-0 z-50"><!--[--><!----><!----><nav aria-label="Main" data-orientation="horizontal" dir="ltr" data-reka-navigation-menu data-collapsed="false" class="relative gap-1.5 [&amp;&gt;div]:min-w-0 justify-between my-4 flex items-center text-sm font-medium text-neutral-800 rounded-full shadow-lg bg-white/90 shadow-neutral-800/5 ring-1 backdrop-blur dark:bg-neutral-800/90 dark:text-neutral-200 dark:ring-white/20 ring-neutral-900/5"><!--[--><!--[--><!--[--><div style="position:relative;"><ul class="isolate min-w-0 flex items-center" data-orientation="horizontal"><!--[--><!--[--><li data-menu-item class="min-w-0 py-2"><!--[--><!--[--><a href="/" class="group relative w-full flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-[calc(var(--ui-radius)*1.5)] focus:outline-none focus-visible:outline-none dark:focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2 focus-visible:before:ring-(--ui-primary) px-2.5 py-1.5 before:inset-x-px before:inset-y-0 text-(--ui-text-muted) after:absolute after:-bottom-2 after:inset-x-2.5 after:block after:h-px after:rounded-full after:transition-colors hover:text-(--ui-text-highlighted) transition-colors data-[state=open]:text-(--ui-text-highlighted) font-bold" data-reka-collection-item><!--[--><!--[--><!--[--><span class="iconify i-heroicons:home-20-solid shrink-0 size-5 text-(--ui-text-dimmed) group-hover:text-(--ui-text) transition-colors group-data-[state=open]:text-(--ui-text)" aria-hidden="true" style=""></span><!--]--><span class="truncate"><!--[-->Home<!--]--><!----></span><!----><!--]--><!--]--></a><!----><!--]--><!--]--></li><li data-menu-item class="min-w-0 py-2"><!--[--><!--[--><a href="/blog" class="group relative w-full flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-[calc(var(--ui-radius)*1.5)] focus:outline-none focus-visible:outline-none dark:focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2 focus-visible:before:ring-(--ui-primary) px-2.5 py-1.5 before:inset-x-px before:inset-y-0 text-(--ui-text-muted) after:absolute after:-bottom-2 after:inset-x-2.5 after:block after:h-px after:rounded-full after:transition-colors hover:text-(--ui-text-highlighted) transition-colors data-[state=open]:text-(--ui-text-highlighted) font-bold" data-reka-collection-item><!--[--><!--[--><!--[--><span class="iconify i-heroicons:book-open-solid shrink-0 size-5 text-(--ui-text-dimmed) group-hover:text-(--ui-text) transition-colors group-data-[state=open]:text-(--ui-text)" aria-hidden="true" style=""></span><!--]--><span class="truncate"><!--[-->Blog<!--]--><!----></span><!----><!--]--><!--]--></a><!----><!--]--><!--]--></li><!--]--><!--]--></ul></div><!----><!--]--><!--[--><div style="position:relative;"><ul class="isolate min-w-0 flex items-center" data-orientation="horizontal"><!--[--><!--[--><li data-menu-item class="min-w-0 py-2"><!--[--><!--[--><!--[--><button type="button" class="group relative w-full flex items-center gap-1.5 font-medium text-sm before:absolute before:z-[-1] before:rounded-[calc(var(--ui-radius)*1.5)] focus:outline-none focus-visible:outline-none dark:focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2 focus-visible:before:ring-(--ui-primary) px-2.5 py-1.5 before:inset-x-px before:inset-y-0 text-(--ui-text-muted) after:absolute after:-bottom-2 after:inset-x-2.5 after:block after:h-px after:rounded-full after:transition-colors hover:text-(--ui-text-highlighted) transition-colors data-[state=open]:text-(--ui-text-highlighted)" data-reka-collection-item><!--[--><!--[--><span></span><!--]--><!--]--></button><!----><!--]--><!--]--><!--]--></li><!--]--><!--]--></ul></div><!----><!--]--><!--]--><div class="absolute top-full left-0 flex w-full justify-center"><!----><!----></div><!--]--></nav><!--]--></div><div class="h-32"></div><div class="w-full mx-auto px-4 sm:px-6 lg:px-8 max-w-2xl min-h-screen"><!--[--><!--[--><div class="blog"><!--[--><article class="prose dark:prose-invert prose-neutral max-w-none prose-a:no-underline"><h1 id="带你了解proxy和reflcet"><!--[-->带你了解Proxy和Reflcet<!--]--></h1><h2 id="一proxy代理"><a href="#一proxy代理"><!--[-->一、Proxy（代理）<!--]--></a></h2><h3 id="_1基本概念"><a href="#_1基本概念"><!--[-->1.基本概念<!--]--></a></h3><p><!--[-->Proxy 对象用于创建一个对象的<code><!--[-->代理<!--]--></code>,从而实现基本操作的<code><!--[-->拦截<!--]--></code>和自定义 （比如:<code><!--[-->属性查找<!--]--></code>、<code><!--[-->赋值<!--]--></code>、<code><!--[-->枚举<!--]--></code>、<code><!--[-->函数调用<!--]--></code>等<!--]--></p><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">const</span><span class="sXTEK"> proxyObject</span><span class="soRP2"> =</span><span class="s8I54"> new</span><span class="scd8n"> Proxy</span><span class="sybYZ">(</span><span class="sVbU4">target</span><span class="sybYZ">,</span><span class="sVbU4"> handler</span><span class="sybYZ">)
</span></span></code><!--]--></pre><ul><!--[--><li><!--[--><code><!--[-->target<!--]--></code>: 代理的目标对象<!--]--></li><li><!--[--><code><!--[-->handler<!--]--></code>: 是一个对象,是定义代理对象行为的函数 。比如<code><!--[-->get<!--]--></code>捕捉器用于读取 target 的属性,<code><!--[-->set<!--]--></code>捕捉器用于写入 target 的属性,等等<!--]--></li><!--]--></ul><h3 id="_2proxy-对对象的拦截"><a href="#_2proxy-对对象的拦截"><!--[-->2.Proxy 对对象的拦截<!--]--></a></h3><p><!--[-->对一个对象的的属性进行读取或写入时,打印相关信息<!--]--></p><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">const</span><span class="sXTEK"> target</span><span class="soRP2"> =</span><span class="sybYZ"> {
</span></span><span class="line" line="2"><span class="sqmIX">  name</span><span class="sybYZ">:</span><span class="sajHj"> &#39;</span><span class="sx1Rn">John</span><span class="sajHj">&#39;</span><span class="sybYZ">,
</span></span><span class="line" line="3"><span class="sqmIX">  age</span><span class="sybYZ">:</span><span class="svno3"> 18</span><span class="sybYZ">,
</span></span><span class="line" line="4"><span class="sybYZ">}
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span class="s8I54">const</span><span class="sXTEK"> proxy</span><span class="soRP2"> =</span><span class="s8I54"> new</span><span class="scd8n"> Proxy</span><span class="sybYZ">(</span><span class="sVbU4">target</span><span class="sybYZ">,</span><span class="sybYZ"> {
</span></span><span class="line" line="7"><span class="scd8n">  get</span><span class="sybYZ">(</span><span class="sSfpy">target</span><span class="sybYZ">,</span><span class="sSfpy"> prop</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="8"><span class="sVbU4">    console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sajHj">`</span><span class="sx1Rn">Getting </span><span class="sOPOU">${</span><span class="sGUJ0">prop</span><span class="sOPOU">}</span><span class="sajHj">`</span><span class="sybYZ">)
</span></span><span class="line" line="9"><span class="scBr_">    return</span><span class="sVbU4"> target</span><span class="sybYZ">[</span><span class="sVbU4">prop</span><span class="sybYZ">]
</span></span><span class="line" line="10"><span class="sybYZ">  },
</span></span><span class="line" line="11"><span class="scd8n">  set</span><span class="sybYZ">(</span><span class="sSfpy">target</span><span class="sybYZ">,</span><span class="sSfpy"> prop</span><span class="sybYZ">,</span><span class="sSfpy"> value</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="12"><span class="sVbU4">    console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sajHj">`</span><span class="sx1Rn">Setting </span><span class="sOPOU">${</span><span class="sGUJ0">prop</span><span class="sOPOU">}</span><span class="sx1Rn"> = </span><span class="sOPOU">${</span><span class="sGUJ0">value</span><span class="sOPOU">}</span><span class="sajHj">`</span><span class="sybYZ">)
</span></span><span class="line" line="13"><span class="sVbU4">    target</span><span class="sybYZ">[</span><span class="sVbU4">prop</span><span class="sybYZ">]</span><span class="soRP2"> =</span><span class="sVbU4"> value
</span></span><span class="line" line="14"><span class="sybYZ">  }
</span></span><span class="line" line="15"><span class="sybYZ">})
</span></span><span class="line" line="16"><span emptylineplaceholder="true">
</span></span><span class="line" line="17"><span class="sVbU4">proxy</span><span class="sybYZ">.</span><span class="sVbU4">name</span><span class="soRP2"> =</span><span class="sajHj"> &#39;</span><span class="sx1Rn">Jane</span><span class="sajHj">&#39;</span><span class="sKXKF"> // Setting name = Jane
</span></span><span class="line" line="18"><span class="sVbU4">proxy</span><span class="sybYZ">.</span><span class="sVbU4">name</span><span class="sKXKF"> // Getting name, Jane
</span></span></code><!--]--></pre><h3 id="_3proxy-对对函数的拦截"><a href="#_3proxy-对对函数的拦截"><!--[-->3.Proxy 对对函数的拦截<!--]--></a></h3><h4 id="_31-拦截函数调用-apply-陷阱"><a href="#_31-拦截函数调用-apply-陷阱"><!--[-->3.1 拦截函数调用 (apply 陷阱)<!--]--></a></h4><blockquote><!--[--><p><!--[-->apply 是 Proxy handler 对象中的一个特殊方法（陷阱）,它用于拦截函数调用操作。当代理的目标对象是一个函数,并且这个函数被调用时（如 proxy() 或 proxy.call()）,apply 陷阱就会被触发。<!--]--></p><!--]--></blockquote><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">const</span><span class="scd8n"> sum</span><span class="soRP2"> =</span><span class="sybYZ"> (</span><span class="sSfpy">a</span><span class="sybYZ">,</span><span class="sSfpy"> b</span><span class="sybYZ">)</span><span class="soRP2"> =&gt;</span><span class="sVbU4"> a</span><span class="s8I54"> +</span><span class="sVbU4"> b
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span class="s8I54">const</span><span class="sXTEK"> proxySum</span><span class="soRP2"> =</span><span class="s8I54"> new</span><span class="scd8n"> Proxy</span><span class="sybYZ">(</span><span class="sVbU4">sum</span><span class="sybYZ">,</span><span class="sybYZ"> {
</span></span><span class="line" line="4"><span class="scd8n">  apply</span><span class="sybYZ">(</span><span class="sSfpy">target</span><span class="sybYZ">,</span><span class="sSfpy"> thisArg</span><span class="sybYZ">,</span><span class="sSfpy"> argArray</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="5"><span class="sKXKF">    // target: 被代理的原始函数
</span></span><span class="line" line="6"><span class="sKXKF">    // thisArg: 调用时的this值
</span></span><span class="line" line="7"><span class="sKXKF">    // argArray: 调用时传递的参数数组
</span></span><span class="line" line="8"><span class="sVbU4">    console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sajHj">`</span><span class="sx1Rn">function name: </span><span class="sOPOU">${</span><span class="sGUJ0">target</span><span class="snnN9">.</span><span class="sGUJ0">name</span><span class="sOPOU">}</span><span class="sajHj">`</span><span class="sybYZ">)</span><span class="sKXKF"> // 通过 target.name 获取函数名
</span></span><span class="line" line="9"><span class="sVbU4">    console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sajHj">`</span><span class="sx1Rn">Calculating sum of </span><span class="sOPOU">${</span><span class="sGUJ0">argArray</span><span class="sOPOU">}</span><span class="sajHj">`</span><span class="sybYZ">)
</span></span><span class="line" line="10"><span class="scBr_">    return</span><span class="sVbU4"> target</span><span class="sybYZ">.</span><span class="scd8n">apply</span><span class="sybYZ">(</span><span class="sVbU4">target</span><span class="sybYZ">,</span><span class="sVbU4"> argArray</span><span class="sybYZ">)
</span></span><span class="line" line="11"><span class="sybYZ">  },
</span></span><span class="line" line="12"><span class="sybYZ">})
</span></span><span class="line" line="13"><span emptylineplaceholder="true">
</span></span><span class="line" line="14"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="scd8n">proxySum</span><span class="sybYZ">(</span><span class="svno3">1</span><span class="sybYZ">,</span><span class="svno3"> 2</span><span class="sybYZ">))</span><span class="sKXKF"> // Calculating sum of 1,2
</span></span><span class="line" line="15"><span class="sKXKF">// eslint-disable-next-line no-useless-call
</span></span><span class="line" line="16"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">proxySum</span><span class="sybYZ">.</span><span class="scd8n">apply</span><span class="sybYZ">(</span><span class="smuiB">null</span><span class="sybYZ">,</span><span class="sybYZ"> [</span><span class="svno3">3</span><span class="sybYZ">,</span><span class="svno3"> 4</span><span class="sybYZ">]))</span><span class="sKXKF"> // Calculating sum of 3,4
</span></span><span class="line" line="17"><span class="sKXKF">// eslint-disable-next-line no-useless-call
</span></span><span class="line" line="18"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">proxySum</span><span class="sybYZ">.</span><span class="scd8n">call</span><span class="sybYZ">(</span><span class="smuiB">null</span><span class="sybYZ">,</span><span class="svno3"> 5</span><span class="sybYZ">,</span><span class="svno3"> 6</span><span class="sybYZ">))</span><span class="sKXKF"> // Calculating sum of 5,6
</span></span><span class="line" line="19"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">proxySum</span><span class="sybYZ">.</span><span class="scd8n">bind</span><span class="sybYZ">(</span><span class="smuiB">null</span><span class="sybYZ">,</span><span class="svno3"> 7</span><span class="sybYZ">,</span><span class="svno3"> 8</span><span class="sybYZ">)())</span><span class="sKXKF"> // Calculating sum of 7,8
</span></span></code><!--]--></pre><ul><!--[--><li><!--[--><code><!--[-->target<!--]--></code>: 被代理的原始函数对象,可以通过<code><!--[-->target.name<!--]--></code>获取被代理的函数的函数名<!--]--></li><li><!--[--><code><!--[-->thisArg<!--]--></code>: 函数调用时的 <code><!--[-->this<!--]--></code> 值<!--]--></li><li><!--[--><code><!--[-->argArray<!--]--></code>: 调用时传递的参数组成的数组<!--]--></li><!--]--></ul><h4 id="_32-拦截构造函数调用-construct-陷阱"><a href="#_32-拦截构造函数调用-construct-陷阱"><!--[-->3.2 拦截构造函数调用 (construct 陷阱)<!--]--></a></h4><blockquote><!--[--><p><!--[-->construct 陷阱是 Proxy handler 中用于拦截 new 操作符调用的特殊方法。当使用 new 调用被代理的构造函数时,这个陷阱会被触发。<!--]--></p><!--]--></blockquote><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">class</span><span class="s3iJD"> Person</span><span class="sybYZ"> {
</span></span><span class="line" line="2"><span class="s8I54">  constructor</span><span class="sybYZ">(</span><span class="sSfpy">name</span><span class="sybYZ">,</span><span class="sSfpy"> age</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="3"><span class="s_3qV">    this</span><span class="sybYZ">.</span><span class="sVbU4">name</span><span class="soRP2"> =</span><span class="sVbU4"> name
</span></span><span class="line" line="4"><span class="s_3qV">    this</span><span class="sybYZ">.</span><span class="sVbU4">age</span><span class="soRP2"> =</span><span class="sVbU4"> age
</span></span><span class="line" line="5"><span class="sybYZ">  }
</span></span><span class="line" line="6"><span class="sybYZ">}
</span></span><span class="line" line="7"><span emptylineplaceholder="true">
</span></span><span class="line" line="8"><span class="s8I54">const</span><span class="sXTEK"> ProxyPerson</span><span class="soRP2"> =</span><span class="s8I54"> new</span><span class="scd8n"> Proxy</span><span class="sybYZ">(</span><span class="sVbU4">Person</span><span class="sybYZ">,</span><span class="sybYZ"> {
</span></span><span class="line" line="9"><span class="scd8n">  construct</span><span class="sybYZ">(</span><span class="sSfpy">target</span><span class="sybYZ">,</span><span class="sSfpy"> argArray</span><span class="sybYZ">,</span><span class="sSfpy"> newTarget</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="10"><span class="sKXKF">    // target:被代理的原始构造函数
</span></span><span class="line" line="11"><span class="sKXKF">    // argumentsList:构造函数调用时传递的参数数组
</span></span><span class="line" line="12"><span class="sKXKF">    // newTarget:最初被调用的构造函数（通常是代理对象本身）
</span></span><span class="line" line="13"><span class="sVbU4">    console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sajHj">`</span><span class="sx1Rn">Creating </span><span class="sOPOU">${</span><span class="sGUJ0">target</span><span class="snnN9">.</span><span class="sGUJ0">name</span><span class="sOPOU">}</span><span class="sx1Rn"> with args </span><span class="sOPOU">${</span><span class="sGUJ0">argArray</span><span class="sOPOU">}</span><span class="sajHj">`</span><span class="sybYZ">)
</span></span><span class="line" line="14"><span class="sKXKF">    // eslint-disable-next-line new-cap
</span></span><span class="line" line="15"><span class="scBr_">    return</span><span class="s8I54"> new</span><span class="scd8n"> target</span><span class="sybYZ">(</span><span class="soRP2">...</span><span class="sVbU4">argArray</span><span class="sybYZ">)
</span></span><span class="line" line="16"><span class="sybYZ">  }
</span></span><span class="line" line="17"><span class="sybYZ">})
</span></span><span class="line" line="18"><span emptylineplaceholder="true">
</span></span><span class="line" line="19"><span class="s8I54">const</span><span class="sXTEK"> person</span><span class="soRP2"> =</span><span class="s8I54"> new</span><span class="scd8n"> ProxyPerson</span><span class="sybYZ">(</span><span class="sajHj">&#39;</span><span class="sx1Rn">John</span><span class="sajHj">&#39;</span><span class="sybYZ">,</span><span class="svno3"> 30</span><span class="sybYZ">)</span><span class="sKXKF"> // Creating Person with args John,30
</span></span></code><!--]--></pre><ul><!--[--><li><!--[--><code><!--[-->target<!--]--></code>: 被代理的原始函数对象,可以通过 target.name 获取被代理的函数的函数名<!--]--></li><li><!--[--><code><!--[-->argArray<!--]--></code>: 调用时传递的参数组成的数组<!--]--></li><li><!--[--><code><!--[-->newTarget<!--]--></code>: 最初被调用的构造函数（通常是代理对象本身）<!--]--></li><!--]--></ul><h2 id="二reflect反射"><a href="#二reflect反射"><!--[-->二、Reflect（反射）<!--]--></a></h2><blockquote><!--[--><p><!--[-->Reflect 是用于调用对象的基本操作（内部方法）<!--]--></p><!--]--></blockquote><blockquote><!--[--><p><!--[-->对象的所有内部方法,参考链接:<a href="https://ecma-international.org/wp-content/uploads/ECMA-262_15th_edition_june_2024.pdf" rel="nofollow"><!--[-->https://ecma-international.org/wp-content/uploads/ECMA-262_15th_edition_june_2024.pdf<!--]--></a> 第 44~46 页内容<!--]--></p><!--]--></blockquote><blockquote><!--[--><p><!--[-->内部方法与 Reflcet 方法对应表格,参考链接:<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" rel="nofollow"><!--[-->https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy<!--]--></a><!--]--></p><!--]--></blockquote><p><!--[--><code><!--[-->Reflect<!--]--></code>不是一个函数对象,因此它是不可构造的。并且 reflect 的所有属性和方法都是静态的。<!--]--></p><h3 id="_1-使用reflcet和直接使用语法操作对象的区别"><a href="#_1-使用reflcet和直接使用语法操作对象的区别"><!--[-->1. 使用<code><!--[-->Reflcet<!--]--></code>和直接使用语法操作对象的区别<!--]--></a></h3><h4 id="_11-返回值不同"><a href="#_11-返回值不同"><!--[-->1.1 返回值不同<!--]--></a></h4><p><!--[-->例如: 给对象添加属性并设置值<!--]--></p><ul><!--[--><li><!--[--><strong><!--[-->直接设置<!--]--></strong>:返回设置的值（表达式的结果）<!--]--></li><!--]--></ul><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">const</span><span class="sXTEK"> obj</span><span class="soRP2"> =</span><span class="sybYZ"> {}
</span></span><span class="line" line="2"><span class="s8I54">const</span><span class="sXTEK"> result</span><span class="soRP2"> =</span><span class="sybYZ"> (</span><span class="sVbU4">obj</span><span class="sybYZ">.</span><span class="sVbU4">name</span><span class="soRP2"> =</span><span class="sajHj"> &#39;</span><span class="sx1Rn">jack</span><span class="sajHj">&#39;</span><span class="sybYZ">)
</span></span><span class="line" line="3"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">)</span><span class="sKXKF"> // { name: &#39;jack&#39; }
</span></span><span class="line" line="4"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">result</span><span class="sybYZ">)</span><span class="sKXKF"> // jack
</span></span></code><!--]--></pre><ul><!--[--><li><!--[--><strong><!--[-->使用 Reflect<!--]--></strong>:返回一个布尔值,表示是否成功<!--]--></li><!--]--></ul><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">const</span><span class="sXTEK"> obj</span><span class="soRP2"> =</span><span class="sybYZ"> {}
</span></span><span class="line" line="2"><span class="s8I54">const</span><span class="sXTEK"> result</span><span class="soRP2"> =</span><span class="sVbU4"> Reflect</span><span class="sybYZ">.</span><span class="scd8n">set</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">,</span><span class="sajHj"> &#39;</span><span class="sx1Rn">name</span><span class="sajHj">&#39;</span><span class="sybYZ">,</span><span class="sajHj"> &#39;</span><span class="sx1Rn">jack</span><span class="sajHj">&#39;</span><span class="sybYZ">)
</span></span><span class="line" line="3"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">)</span><span class="sKXKF"> // { name: &#39;jack&#39; }
</span></span><span class="line" line="4"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">result</span><span class="sybYZ">)</span><span class="sKXKF"> // true
</span></span></code><!--]--></pre><h4 id="_12-处理不可写属性时的行为"><a href="#_12-处理不可写属性时的行为"><!--[-->1.2 处理不可写属性时的行为<!--]--></a></h4><p><!--[-->例如:给对象的不可写属性赋值时<!--]--></p><p><!--[--><strong><!--[-->直接设置<!--]--></strong>:<!--]--></p><ul><!--[--><li><!--[-->在严格模式下会抛出 TypeError<!--]--></li><!--]--></ul><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="sajHj">&#39;</span><span class="sx1Rn">use strict</span><span class="sajHj">&#39;
</span></span><span class="line" line="2"><span class="s8I54">const</span><span class="sXTEK"> obj</span><span class="soRP2"> =</span><span class="sybYZ"> {}
</span></span><span class="line" line="3"><span class="sVbU4">Object</span><span class="sybYZ">.</span><span class="scd8n">defineProperty</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">,</span><span class="sajHj"> &#39;</span><span class="sx1Rn">age</span><span class="sajHj">&#39;</span><span class="sybYZ">,</span><span class="sybYZ"> {
</span></span><span class="line" line="4"><span class="sqmIX">  value</span><span class="sybYZ">:</span><span class="svno3"> 18</span><span class="sybYZ">,
</span></span><span class="line" line="5"><span class="sqmIX">  writeable</span><span class="sybYZ">:</span><span class="sSBLT"> false</span><span class="sybYZ">,
</span></span><span class="line" line="6"><span class="sybYZ">})
</span></span><span class="line" line="7"><span class="sVbU4">obj</span><span class="sybYZ">.</span><span class="sVbU4">age</span><span class="soRP2"> =</span><span class="svno3"> 20</span><span class="sKXKF"> // TypeError: Cannot assign to read only property &#39;age&#39; of object &#39;#&lt;Object&gt;&#39;
</span></span></code><!--]--></pre><ul><!--[--><li><!--[-->在非严格模式下静默失败<!--]--></li><!--]--></ul><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">const</span><span class="sXTEK"> obj</span><span class="soRP2"> =</span><span class="sybYZ"> {}
</span></span><span class="line" line="2"><span class="sVbU4">Object</span><span class="sybYZ">.</span><span class="scd8n">defineProperty</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">,</span><span class="sajHj"> &#39;</span><span class="sx1Rn">age</span><span class="sajHj">&#39;</span><span class="sybYZ">,</span><span class="sybYZ"> {
</span></span><span class="line" line="3"><span class="sqmIX">  value</span><span class="sybYZ">:</span><span class="svno3"> 18</span><span class="sybYZ">,
</span></span><span class="line" line="4"><span class="sqmIX">  writeable</span><span class="sybYZ">:</span><span class="sSBLT"> false</span><span class="sybYZ">,
</span></span><span class="line" line="5"><span class="sybYZ">})
</span></span><span class="line" line="6"><span class="sVbU4">obj</span><span class="sybYZ">.</span><span class="sVbU4">age</span><span class="soRP2"> =</span><span class="svno3"> 20
</span></span><span class="line" line="7"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">.</span><span class="sVbU4">age</span><span class="sybYZ">)</span><span class="sKXKF"> // 18
</span></span></code><!--]--></pre><p><!--[--><strong><!--[-->Reflect.set()<!--]--></strong>: 总是返回 false 而不抛出错误<!--]--></p><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="sajHj">&#39;</span><span class="sx1Rn">use strict</span><span class="sajHj">&#39;
</span></span><span class="line" line="2"><span class="s8I54">const</span><span class="sXTEK"> obj</span><span class="soRP2"> =</span><span class="sybYZ"> {}
</span></span><span class="line" line="3"><span class="sVbU4">Object</span><span class="sybYZ">.</span><span class="scd8n">defineProperty</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">,</span><span class="sajHj"> &#39;</span><span class="sx1Rn">age</span><span class="sajHj">&#39;</span><span class="sybYZ">,</span><span class="sybYZ"> {
</span></span><span class="line" line="4"><span class="sqmIX">  value</span><span class="sybYZ">:</span><span class="svno3"> 18</span><span class="sybYZ">,
</span></span><span class="line" line="5"><span class="sqmIX">  writeable</span><span class="sybYZ">:</span><span class="sSBLT"> false</span><span class="sybYZ">,
</span></span><span class="line" line="6"><span class="sybYZ">})
</span></span><span class="line" line="7"><span class="s8I54">const</span><span class="sXTEK"> result</span><span class="soRP2"> =</span><span class="sVbU4"> Reflect</span><span class="sybYZ">.</span><span class="scd8n">set</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">,</span><span class="sajHj"> &#39;</span><span class="sx1Rn">age</span><span class="sajHj">&#39;</span><span class="sybYZ">,</span><span class="svno3"> 20</span><span class="sybYZ">)
</span></span><span class="line" line="8"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">result</span><span class="sybYZ">)</span><span class="sKXKF"> // false
</span></span><span class="line" line="9"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">.</span><span class="sVbU4">age</span><span class="sybYZ">)</span><span class="sKXKF"> // 18
</span></span></code><!--]--></pre><h4 id="_13-指定-receiverthis"><a href="#_13-指定-receiverthis"><!--[-->1.3 指定 receiver(this)<!--]--></a></h4><p><!--[-->例如:对象中的 getter 的借用<!--]--></p><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">const</span><span class="sXTEK"> obj</span><span class="soRP2"> =</span><span class="sybYZ"> {
</span></span><span class="line" line="2"><span class="sqmIX">  a</span><span class="sybYZ">:</span><span class="svno3"> 1</span><span class="sybYZ">,
</span></span><span class="line" line="3"><span class="sqmIX">  b</span><span class="sybYZ">:</span><span class="svno3"> 2</span><span class="sybYZ">,
</span></span><span class="line" line="4"><span class="s8I54">  get</span><span class="scd8n"> c</span><span class="sybYZ">()</span><span class="sybYZ"> {
</span></span><span class="line" line="5"><span class="scBr_">    return</span><span class="s_3qV"> this</span><span class="sybYZ">.</span><span class="sVbU4">a</span><span class="s8I54"> +</span><span class="s_3qV"> this</span><span class="sybYZ">.</span><span class="sVbU4">b
</span></span><span class="line" line="6"><span class="sybYZ">  }
</span></span><span class="line" line="7"><span class="sybYZ">}
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span class="s8I54">const</span><span class="sXTEK"> obj2</span><span class="soRP2"> =</span><span class="sybYZ"> {
</span></span><span class="line" line="10"><span class="sqmIX">  a</span><span class="sybYZ">:</span><span class="svno3"> 3</span><span class="sybYZ">,
</span></span><span class="line" line="11"><span class="sqmIX">  b</span><span class="sybYZ">:</span><span class="svno3"> 4</span><span class="sybYZ">,
</span></span><span class="line" line="12"><span class="sybYZ">}
</span></span><span class="line" line="13"><span emptylineplaceholder="true">
</span></span><span class="line" line="14"><span class="sVbU4">obj2</span><span class="sybYZ">.</span><span class="sVbU4">c</span><span class="soRP2"> =</span><span class="sVbU4"> obj</span><span class="sybYZ">.</span><span class="sVbU4">c
</span></span><span class="line" line="15"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">obj2</span><span class="sybYZ">.</span><span class="sVbU4">c</span><span class="sybYZ">)</span><span class="sKXKF"> // 3 (不是7)
</span></span></code><!--]--></pre><p><!--[-->直接赋值只是复制了值,不会保持 <code><!--[-->getter<!--]--></code> 的动态计算特性, 无法直接实现对<code><!--[-->getter<!--]--></code>的借用<!--]--></p><ul><!--[--><li><!--[-->使用<code><!--[-->bind<!--]--></code>可以实现,但是需要手动获取属性描述符<!--]--></li><!--]--></ul><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">const</span><span class="sXTEK"> obj</span><span class="soRP2"> =</span><span class="sybYZ"> {
</span></span><span class="line" line="2"><span class="sqmIX">  a</span><span class="sybYZ">:</span><span class="svno3"> 1</span><span class="sybYZ">,
</span></span><span class="line" line="3"><span class="sqmIX">  b</span><span class="sybYZ">:</span><span class="svno3"> 2</span><span class="sybYZ">,
</span></span><span class="line" line="4"><span class="s8I54">  get</span><span class="scd8n"> c</span><span class="sybYZ">()</span><span class="sybYZ"> {
</span></span><span class="line" line="5"><span class="scBr_">    return</span><span class="s_3qV"> this</span><span class="sybYZ">.</span><span class="sVbU4">a</span><span class="s8I54"> +</span><span class="s_3qV"> this</span><span class="sybYZ">.</span><span class="sVbU4">b
</span></span><span class="line" line="6"><span class="sybYZ">  }
</span></span><span class="line" line="7"><span class="sybYZ">}
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span class="s8I54">const</span><span class="sXTEK"> obj2</span><span class="soRP2"> =</span><span class="sybYZ"> {
</span></span><span class="line" line="10"><span class="sqmIX">  a</span><span class="sybYZ">:</span><span class="svno3"> 3</span><span class="sybYZ">,
</span></span><span class="line" line="11"><span class="sqmIX">  b</span><span class="sybYZ">:</span><span class="svno3"> 4</span><span class="sybYZ">,
</span></span><span class="line" line="12"><span class="sybYZ">}
</span></span><span class="line" line="13"><span emptylineplaceholder="true">
</span></span><span class="line" line="14"><span class="sKXKF">// 获取 getter 函数
</span></span><span class="line" line="15"><span class="s8I54">const</span><span class="sXTEK"> descriptor</span><span class="soRP2"> =</span><span class="sVbU4"> Object</span><span class="sybYZ">.</span><span class="scd8n">getOwnPropertyDescriptor</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">,</span><span class="sajHj"> &#39;</span><span class="sx1Rn">c</span><span class="sajHj">&#39;</span><span class="sybYZ">)</span><span class="sKXKF"> // 获取属性描述符
</span></span><span class="line" line="16"><span class="s8I54">const</span><span class="sXTEK"> getter</span><span class="soRP2"> =</span><span class="sVbU4"> descriptor</span><span class="sybYZ">.</span><span class="sVbU4">get</span><span class="sKXKF"> // 获取getter 函数
</span></span><span class="line" line="17"><span emptylineplaceholder="true">
</span></span><span class="line" line="18"><span class="sKXKF">// 绑定 this
</span></span><span class="line" line="19"><span class="s8I54">const</span><span class="sXTEK"> boundGetter</span><span class="soRP2"> =</span><span class="sVbU4"> getter</span><span class="sybYZ">.</span><span class="scd8n">bind</span><span class="sybYZ">(</span><span class="sVbU4">obj2</span><span class="sybYZ">)
</span></span><span class="line" line="20"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="scd8n">boundGetter</span><span class="sybYZ">())</span><span class="sKXKF"> // 7
</span></span></code><!--]--></pre><ul><!--[--><li><!--[-->使用<code><!--[-->Reflect<!--]--></code>改变<code><!--[-->this<!--]--></code>可以直接实现<code><!--[-->getter<!--]--></code>的借用<!--]--></li><!--]--></ul><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">const</span><span class="sXTEK"> obj</span><span class="soRP2"> =</span><span class="sybYZ"> {
</span></span><span class="line" line="2"><span class="sqmIX">  a</span><span class="sybYZ">:</span><span class="svno3"> 1</span><span class="sybYZ">,
</span></span><span class="line" line="3"><span class="sqmIX">  b</span><span class="sybYZ">:</span><span class="svno3"> 2</span><span class="sybYZ">,
</span></span><span class="line" line="4"><span class="s8I54">  get</span><span class="scd8n"> c</span><span class="sybYZ">()</span><span class="sybYZ"> {
</span></span><span class="line" line="5"><span class="scBr_">    return</span><span class="s_3qV"> this</span><span class="sybYZ">.</span><span class="sVbU4">a</span><span class="s8I54"> +</span><span class="s_3qV"> this</span><span class="sybYZ">.</span><span class="sVbU4">b
</span></span><span class="line" line="6"><span class="sybYZ">  }
</span></span><span class="line" line="7"><span class="sybYZ">}
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span class="s8I54">const</span><span class="sXTEK"> obj2</span><span class="soRP2"> =</span><span class="sybYZ"> {
</span></span><span class="line" line="10"><span class="sqmIX">  a</span><span class="sybYZ">:</span><span class="svno3"> 3</span><span class="sybYZ">,
</span></span><span class="line" line="11"><span class="sqmIX">  b</span><span class="sybYZ">:</span><span class="svno3"> 4</span><span class="sybYZ">,
</span></span><span class="line" line="12"><span class="sybYZ">}
</span></span><span class="line" line="13"><span emptylineplaceholder="true">
</span></span><span class="line" line="14"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">Reflect</span><span class="sybYZ">.</span><span class="scd8n">get</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">,</span><span class="sajHj"> &#39;</span><span class="sx1Rn">c</span><span class="sajHj">&#39;</span><span class="sybYZ">,</span><span class="sVbU4"> obj2</span><span class="sybYZ">))</span><span class="sKXKF"> // 7
</span></span></code><!--]--></pre><h3 id="_2-在-proxy-中使用-reflect-的作用"><a href="#_2-在-proxy-中使用-reflect-的作用"><!--[-->2. 在 Proxy 中使用 Reflect 的作用<!--]--></a></h3><h4 id="_21-保持默认行为"><a href="#_21-保持默认行为"><!--[-->2.1 保持默认行为<!--]--></a></h4><p><!--[--><code><!--[-->Reflect<!--]--></code>方法提供了与 Proxy 陷阱一一对应的操作,可以方便地在自定义行为后保持默认行为<!--]--></p><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">const</span><span class="sXTEK"> proxy</span><span class="soRP2"> =</span><span class="s8I54"> new</span><span class="scd8n"> Proxy</span><span class="sybYZ">(</span><span class="sVbU4">target</span><span class="sybYZ">,</span><span class="sybYZ"> {
</span></span><span class="line" line="2"><span class="scd8n">  get</span><span class="sybYZ">(</span><span class="sSfpy">target</span><span class="sybYZ">,</span><span class="sSfpy"> prop</span><span class="sybYZ">,</span><span class="sSfpy"> receiver</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="3"><span class="sVbU4">    console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sajHj">`</span><span class="sx1Rn">Getting property </span><span class="sOPOU">${</span><span class="sGUJ0">prop</span><span class="sOPOU">}</span><span class="sajHj">`</span><span class="sybYZ">)
</span></span><span class="line" line="4"><span class="sKXKF">    // 使用 Reflect 保持默认的获取行为
</span></span><span class="line" line="5"><span class="scBr_">    return</span><span class="sVbU4"> Reflect</span><span class="sybYZ">.</span><span class="scd8n">get</span><span class="sybYZ">(</span><span class="sVbU4">target</span><span class="sybYZ">,</span><span class="sVbU4"> prop</span><span class="sybYZ">,</span><span class="sVbU4"> receiver</span><span class="sybYZ">)
</span></span><span class="line" line="6"><span class="sybYZ">  }
</span></span><span class="line" line="7"><span class="sybYZ">})
</span></span></code><!--]--></pre><p><!--[-->Reflect 方法提供了与 Proxy 陷阱完美对应,使代码更一致<!--]--></p><table><!--[--><thead><!--[--><tr><!--[--><th><!--[-->Proxy 陷阱<!--]--></th><th><!--[-->Reflect 方法<!--]--></th><!--]--></tr><!--]--></thead><tbody><!--[--><tr><!--[--><td><!--[-->get<!--]--></td><td><!--[-->Reflect.get()<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->set<!--]--></td><td><!--[-->Reflect.set()<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->has<!--]--></td><td><!--[-->Reflect.has()<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->deleteProperty<!--]--></td><td><!--[-->Reflect.deleteProperty()<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->apply<!--]--></td><td><!--[-->Reflect.apply()<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->construct<!--]--></td><td><!--[-->Reflect.construct()<!--]--></td><!--]--></tr><!--]--></tbody><!--]--></table><h4 id="_22-确保正确的this"><a href="#_22-确保正确的this"><!--[-->2.2 确保正确的<code><!--[-->this<!--]--></code><!--]--></a></h4><p><!--[-->例如: 在存在继承的对象中<!--]--></p><ul><!--[--><li><!--[-->直接通过 target 访问<!--]--></li><!--]--></ul><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">const</span><span class="sXTEK"> obj</span><span class="soRP2"> =</span><span class="sybYZ"> {
</span></span><span class="line" line="2"><span class="sqmIX">  a</span><span class="sybYZ">:</span><span class="svno3"> 1</span><span class="sybYZ">,
</span></span><span class="line" line="3"><span class="sqmIX">  b</span><span class="sybYZ">:</span><span class="svno3"> 2</span><span class="sybYZ">,
</span></span><span class="line" line="4"><span class="s8I54">  get</span><span class="scd8n"> c</span><span class="sybYZ">()</span><span class="sybYZ"> {
</span></span><span class="line" line="5"><span class="scBr_">    return</span><span class="s_3qV"> this</span><span class="sybYZ">.</span><span class="sVbU4">a</span><span class="s8I54"> +</span><span class="s_3qV"> this</span><span class="sybYZ">.</span><span class="sVbU4">b
</span></span><span class="line" line="6"><span class="sybYZ">  }
</span></span><span class="line" line="7"><span class="sybYZ">}
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span class="s8I54">const</span><span class="sXTEK"> proxy</span><span class="soRP2"> =</span><span class="s8I54"> new</span><span class="scd8n"> Proxy</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">,</span><span class="sybYZ"> {
</span></span><span class="line" line="10"><span class="scd8n">  get</span><span class="sybYZ">(</span><span class="sSfpy">target</span><span class="sybYZ">,</span><span class="sSfpy"> prop</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="11"><span class="scBr_">    return</span><span class="sVbU4"> target</span><span class="sybYZ">[</span><span class="sVbU4">prop</span><span class="sybYZ">]</span><span class="sKXKF"> // 直接使用 target 会导致 this 绑定问题
</span></span><span class="line" line="12"><span class="sybYZ">  }
</span></span><span class="line" line="13"><span class="sybYZ">})
</span></span><span class="line" line="14"><span emptylineplaceholder="true">
</span></span><span class="line" line="15"><span class="s8I54">const</span><span class="sXTEK"> obj2</span><span class="soRP2"> =</span><span class="sVbU4"> Object</span><span class="sybYZ">.</span><span class="scd8n">create</span><span class="sybYZ">(</span><span class="sVbU4">proxy</span><span class="sybYZ">)</span><span class="sKXKF"> // 继承proxy
</span></span><span class="line" line="16"><span class="sVbU4">obj2</span><span class="sybYZ">.</span><span class="sVbU4">a</span><span class="soRP2"> =</span><span class="svno3"> 3
</span></span><span class="line" line="17"><span class="sVbU4">obj2</span><span class="sybYZ">.</span><span class="sVbU4">b</span><span class="soRP2"> =</span><span class="svno3"> 4
</span></span><span class="line" line="18"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">obj2</span><span class="sybYZ">.</span><span class="sVbU4">c</span><span class="sybYZ">)</span><span class="sKXKF"> // 3
</span></span></code><!--]--></pre><blockquote><!--[--><p><!--[-->我们期望 obj2.c 应该计算 obj2.a + obj2.b,即 3 + 4 = 7
实际输出却是 3,这是因为:
a. obj2.c 触发 proxy 的 get 陷阱
b. 陷阱中直接返回 target <span>prop</span> （即 obj.c）
c. 当 obj.c 的 getter 执行时,this 指向的是 obj 而非 obj2
d. 所以计算的是 obj.a + obj.b（1 + 2 = 3）<!--]--></p><!--]--></blockquote><ul><!--[--><li><!--[-->使用 Reflect,传递 receiver<!--]--></li><!--]--></ul><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">const</span><span class="sXTEK"> obj</span><span class="soRP2"> =</span><span class="sybYZ"> {
</span></span><span class="line" line="2"><span class="sqmIX">  a</span><span class="sybYZ">:</span><span class="svno3"> 1</span><span class="sybYZ">,
</span></span><span class="line" line="3"><span class="sqmIX">  b</span><span class="sybYZ">:</span><span class="svno3"> 2</span><span class="sybYZ">,
</span></span><span class="line" line="4"><span class="s8I54">  get</span><span class="scd8n"> c</span><span class="sybYZ">()</span><span class="sybYZ"> {
</span></span><span class="line" line="5"><span class="scBr_">    return</span><span class="s_3qV"> this</span><span class="sybYZ">.</span><span class="sVbU4">a</span><span class="s8I54"> +</span><span class="s_3qV"> this</span><span class="sybYZ">.</span><span class="sVbU4">b
</span></span><span class="line" line="6"><span class="sybYZ">  }
</span></span><span class="line" line="7"><span class="sybYZ">}
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span class="s8I54">const</span><span class="sXTEK"> proxy</span><span class="soRP2"> =</span><span class="s8I54"> new</span><span class="scd8n"> Proxy</span><span class="sybYZ">(</span><span class="sVbU4">obj</span><span class="sybYZ">,</span><span class="sybYZ"> {
</span></span><span class="line" line="10"><span class="scd8n">  get</span><span class="sybYZ">(</span><span class="sSfpy">target</span><span class="sybYZ">,</span><span class="sSfpy"> prop</span><span class="sybYZ">,</span><span class="sSfpy"> receiver</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="11"><span class="scBr_">    return</span><span class="sVbU4"> Reflect</span><span class="sybYZ">.</span><span class="scd8n">get</span><span class="sybYZ">(</span><span class="sVbU4">target</span><span class="sybYZ">,</span><span class="sVbU4"> prop</span><span class="sybYZ">,</span><span class="sVbU4"> receiver</span><span class="sybYZ">)</span><span class="sKXKF"> // receiver 参数会自动指向最初发起调用的对象
</span></span><span class="line" line="12"><span class="sybYZ">  }
</span></span><span class="line" line="13"><span class="sybYZ">})
</span></span><span class="line" line="14"><span emptylineplaceholder="true">
</span></span><span class="line" line="15"><span class="s8I54">const</span><span class="sXTEK"> obj2</span><span class="soRP2"> =</span><span class="sVbU4"> Object</span><span class="sybYZ">.</span><span class="scd8n">create</span><span class="sybYZ">(</span><span class="sVbU4">proxy</span><span class="sybYZ">)
</span></span><span class="line" line="16"><span class="sVbU4">obj2</span><span class="sybYZ">.</span><span class="sVbU4">a</span><span class="soRP2"> =</span><span class="svno3"> 3
</span></span><span class="line" line="17"><span class="sVbU4">obj2</span><span class="sybYZ">.</span><span class="sVbU4">b</span><span class="soRP2"> =</span><span class="svno3"> 4
</span></span><span class="line" line="18"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">obj2</span><span class="sybYZ">.</span><span class="sVbU4">c</span><span class="sybYZ">)</span><span class="sKXKF"> // 7
</span></span></code><!--]--></pre><h4 id="_23-总结在proxy中使用reflect的原因"><a href="#_23-总结在proxy中使用reflect的原因"><!--[-->2.3 总结:在<code><!--[-->Proxy<!--]--></code>中使用<code><!--[-->Reflect<!--]--></code>的原因<!--]--></a></h4><ol><!--[--><li><!--[-->保持代理透明性:直接操作可能绕过代理陷阱<!--]--></li><li><!--[-->维护不变式:确保代理行为与原始对象一致<!--]--></li><li><!--[-->处理特殊属性:正确处理 getter/setter 和原型链属性<!--]--></li><!--]--></ol><h2 id="三proxy-与-reflect-的应用"><a href="#三proxy-与-reflect-的应用"><!--[-->三、Proxy 与 Reflect 的应用<!--]--></a></h2><h3 id="_1-实现观察者模式"><a href="#_1-实现观察者模式"><!--[-->1. 实现观察者模式<!--]--></a></h3><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">function</span><span class="scd8n"> createObservable</span><span class="sybYZ">(</span><span class="sSfpy">object</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="2"><span class="s8I54">  const</span><span class="sXTEK"> observers</span><span class="soRP2"> =</span><span class="s8I54"> new</span><span class="scd8n"> Map</span><span class="sybYZ">()</span><span class="sKXKF"> // 存储属性与观察者回调的映射
</span></span><span class="line" line="3"><span class="scBr_">  return</span><span class="s8I54"> new</span><span class="scd8n"> Proxy</span><span class="sybYZ">(</span><span class="sVbU4">object</span><span class="sybYZ">,</span><span class="sybYZ"> {
</span></span><span class="line" line="4"><span class="scd8n">    set</span><span class="sybYZ">(</span><span class="sSfpy">target</span><span class="sybYZ">,</span><span class="sSfpy"> p</span><span class="sybYZ">,</span><span class="sSfpy"> newValue</span><span class="sybYZ">,</span><span class="sSfpy"> receiver</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="5"><span class="s8I54">      const</span><span class="sXTEK"> isSuccess</span><span class="soRP2"> =</span><span class="sVbU4"> Reflect</span><span class="sybYZ">.</span><span class="scd8n">set</span><span class="sybYZ">(</span><span class="sVbU4">target</span><span class="sybYZ">,</span><span class="sVbU4"> p</span><span class="sybYZ">,</span><span class="sVbU4"> newValue</span><span class="sybYZ">,</span><span class="sVbU4"> receiver</span><span class="sybYZ">)
</span></span><span class="line" line="6"><span class="scBr_">      if</span><span class="sybYZ"> (</span><span class="sVbU4">isSuccess</span><span class="s8I54"> &amp;&amp;</span><span class="sVbU4"> observers</span><span class="sybYZ">.</span><span class="scd8n">has</span><span class="sybYZ">(</span><span class="sVbU4">p</span><span class="sybYZ">))</span><span class="sybYZ"> {
</span></span><span class="line" line="7"><span class="sKXKF">        // 通知该属性的所有观察者
</span></span><span class="line" line="8"><span class="sVbU4">        observers</span><span class="sybYZ">.</span><span class="scd8n">get</span><span class="sybYZ">(</span><span class="sVbU4">p</span><span class="sybYZ">).</span><span class="scd8n">forEach</span><span class="sybYZ">((</span><span class="sSfpy">cb</span><span class="sybYZ">)</span><span class="soRP2"> =&gt;</span><span class="sybYZ"> {
</span></span><span class="line" line="9"><span class="scd8n">          cb</span><span class="sybYZ">(</span><span class="sVbU4">newValue</span><span class="sybYZ">)
</span></span><span class="line" line="10"><span class="sybYZ">        })
</span></span><span class="line" line="11"><span class="sybYZ">      }
</span></span><span class="line" line="12"><span class="sybYZ">    },
</span></span><span class="line" line="13"><span class="scd8n">    get</span><span class="sybYZ">(</span><span class="sSfpy">target</span><span class="sybYZ">,</span><span class="sSfpy"> p</span><span class="sybYZ">,</span><span class="sSfpy"> receiver</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="14"><span class="scBr_">      if</span><span class="sybYZ"> (</span><span class="sVbU4">p</span><span class="s8I54"> ===</span><span class="sajHj"> &#39;</span><span class="sx1Rn">observe</span><span class="sajHj">&#39;</span><span class="sybYZ">)</span><span class="sybYZ"> {</span><span class="sKXKF"> // 通过 handler 的 get 陷阱暴露方法
</span></span><span class="line" line="15"><span class="scBr_">        return</span><span class="sybYZ"> (</span><span class="sSfpy">p</span><span class="sybYZ">,</span><span class="sSfpy"> callback</span><span class="sybYZ">)</span><span class="soRP2"> =&gt;</span><span class="sybYZ"> {
</span></span><span class="line" line="16"><span class="scBr_">          if</span><span class="sybYZ"> (</span><span class="sVbU4">observers</span><span class="sybYZ">.</span><span class="scd8n">has</span><span class="sybYZ">(</span><span class="sVbU4">p</span><span class="sybYZ">))</span><span class="sybYZ"> {
</span></span><span class="line" line="17"><span class="sVbU4">            observers</span><span class="sybYZ">.</span><span class="scd8n">get</span><span class="sybYZ">(</span><span class="sVbU4">p</span><span class="sybYZ">).</span><span class="scd8n">add</span><span class="sybYZ">(</span><span class="sVbU4">callback</span><span class="sybYZ">)
</span></span><span class="line" line="18"><span class="sybYZ">          }
</span></span><span class="line" line="19"><span class="scBr_">          else</span><span class="sybYZ"> {
</span></span><span class="line" line="20"><span class="sVbU4">            observers</span><span class="sybYZ">.</span><span class="scd8n">set</span><span class="sybYZ">(</span><span class="sVbU4">p</span><span class="sybYZ">,</span><span class="sybYZ"> [</span><span class="sVbU4">callback</span><span class="sybYZ">])
</span></span><span class="line" line="21"><span class="sybYZ">          }
</span></span><span class="line" line="22"><span class="scBr_">          return</span><span class="sybYZ"> ()</span><span class="soRP2"> =&gt;</span><span class="sybYZ"> {
</span></span><span class="line" line="23"><span class="s8I54">            const</span><span class="sXTEK"> callbacks</span><span class="soRP2"> =</span><span class="sVbU4"> observers</span><span class="sybYZ">.</span><span class="scd8n">get</span><span class="sybYZ">(</span><span class="sVbU4">p</span><span class="sybYZ">)
</span></span><span class="line" line="24"><span class="s8I54">            const</span><span class="sXTEK"> index</span><span class="soRP2"> =</span><span class="sVbU4"> callbacks</span><span class="sybYZ">.</span><span class="scd8n">indexOf</span><span class="sybYZ">(</span><span class="sVbU4">callback</span><span class="sybYZ">)
</span></span><span class="line" line="25"><span class="scBr_">            if</span><span class="sybYZ"> (</span><span class="sVbU4">index</span><span class="soRP2"> &gt;</span><span class="s8I54"> -</span><span class="svno3">1</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="26"><span class="sVbU4">              callbacks</span><span class="sybYZ">.</span><span class="scd8n">splice</span><span class="sybYZ">(</span><span class="sVbU4">index</span><span class="sybYZ">,</span><span class="svno3"> 1</span><span class="sybYZ">)
</span></span><span class="line" line="27"><span class="sybYZ">            }
</span></span><span class="line" line="28"><span class="sybYZ">          }
</span></span><span class="line" line="29"><span class="sybYZ">        }
</span></span><span class="line" line="30"><span class="sybYZ">      }
</span></span><span class="line" line="31"><span class="scBr_">      return</span><span class="sVbU4"> Reflect</span><span class="sybYZ">.</span><span class="scd8n">get</span><span class="sybYZ">(</span><span class="sVbU4">target</span><span class="sybYZ">,</span><span class="sVbU4"> p</span><span class="sybYZ">,</span><span class="sVbU4"> receiver</span><span class="sybYZ">)
</span></span><span class="line" line="32"><span class="sybYZ">    },
</span></span><span class="line" line="33"><span class="sybYZ">  })
</span></span><span class="line" line="34"><span class="sybYZ">}
</span></span><span class="line" line="35"><span class="s8I54">const</span><span class="sXTEK"> person</span><span class="soRP2"> =</span><span class="scd8n"> createObservable</span><span class="sybYZ">({
</span></span><span class="line" line="36"><span class="sqmIX">  name</span><span class="sybYZ">:</span><span class="sajHj"> &#39;</span><span class="sx1Rn">John</span><span class="sajHj">&#39;</span><span class="sybYZ">,
</span></span><span class="line" line="37"><span class="sqmIX">  age</span><span class="sybYZ">:</span><span class="svno3"> 30</span><span class="sybYZ">,
</span></span><span class="line" line="38"><span class="sybYZ">})
</span></span><span class="line" line="39"><span emptylineplaceholder="true">
</span></span><span class="line" line="40"><span class="s8I54">const</span><span class="sXTEK"> unsubscribe</span><span class="soRP2"> =</span><span class="sVbU4"> person</span><span class="sybYZ">.</span><span class="scd8n">observe</span><span class="sybYZ">(</span><span class="sajHj">&#39;</span><span class="sx1Rn">name</span><span class="sajHj">&#39;</span><span class="sybYZ">,</span><span class="sybYZ"> (</span><span class="sSfpy">newName</span><span class="sybYZ">)</span><span class="soRP2"> =&gt;</span><span class="sybYZ"> {
</span></span><span class="line" line="41"><span class="sVbU4">  console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sajHj">`</span><span class="sx1Rn">Name changed to </span><span class="sOPOU">${</span><span class="sGUJ0">newName</span><span class="sOPOU">}</span><span class="sajHj">`</span><span class="sybYZ">)
</span></span><span class="line" line="42"><span class="sybYZ">})
</span></span><span class="line" line="43"><span emptylineplaceholder="true">
</span></span><span class="line" line="44"><span class="sVbU4">person</span><span class="sybYZ">.</span><span class="sVbU4">name</span><span class="soRP2"> =</span><span class="sajHj"> &#39;</span><span class="sx1Rn">Jane</span><span class="sajHj">&#39;</span><span class="sKXKF"> // 输出: Name changed to Jane
</span></span><span class="line" line="45"><span class="scd8n">unsubscribe</span><span class="sybYZ">()
</span></span><span class="line" line="46"><span class="sVbU4">person</span><span class="sybYZ">.</span><span class="sVbU4">name</span><span class="soRP2"> =</span><span class="sajHj"> &#39;</span><span class="sx1Rn">John</span><span class="sajHj">&#39;</span><span class="sKXKF"> // 不会输出任何内容
</span></span></code><!--]--></pre><h3 id="_2-权限控制"><a href="#_2-权限控制"><!--[-->2. 权限控制<!--]--></a></h3><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">function</span><span class="scd8n"> createSecureObject</span><span class="sybYZ">(</span><span class="sSfpy">role</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="2"><span class="s8I54">  const</span><span class="sXTEK"> data</span><span class="soRP2"> =</span><span class="sybYZ"> {
</span></span><span class="line" line="3"><span class="sqmIX">    sensitiveInfo</span><span class="sybYZ">:</span><span class="sajHj"> &#39;</span><span class="sx1Rn">secret</span><span class="sajHj">&#39;
</span></span><span class="line" line="4"><span class="sybYZ">  }
</span></span><span class="line" line="5"><span class="scBr_">  return</span><span class="s8I54"> new</span><span class="scd8n"> Proxy</span><span class="sybYZ">(</span><span class="sVbU4">data</span><span class="sybYZ">,</span><span class="sybYZ"> {
</span></span><span class="line" line="6"><span class="scd8n">    get</span><span class="sybYZ">:</span><span class="sybYZ"> (</span><span class="sSfpy">target</span><span class="sybYZ">,</span><span class="sSfpy"> p</span><span class="sybYZ">,</span><span class="sSfpy"> receiver</span><span class="sybYZ">)</span><span class="soRP2"> =&gt;</span><span class="sybYZ"> {
</span></span><span class="line" line="7"><span class="scBr_">      if</span><span class="sybYZ"> (</span><span class="sVbU4">p</span><span class="s8I54"> ===</span><span class="sajHj"> &#39;</span><span class="sx1Rn">sensitiveInfo</span><span class="sajHj">&#39;</span><span class="s8I54"> &amp;&amp;</span><span class="sVbU4"> role</span><span class="s8I54"> !==</span><span class="sajHj"> &#39;</span><span class="sx1Rn">admin</span><span class="sajHj">&#39;</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="8"><span class="scBr_">        throw</span><span class="s8I54"> new</span><span class="scd8n"> Error</span><span class="sybYZ">(</span><span class="sajHj">&#39;</span><span class="sx1Rn">Access Denied</span><span class="sajHj">&#39;</span><span class="sybYZ">)
</span></span><span class="line" line="9"><span class="sybYZ">      }
</span></span><span class="line" line="10"><span class="scBr_">      else</span><span class="sybYZ"> {
</span></span><span class="line" line="11"><span class="scBr_">        return</span><span class="sVbU4"> Reflect</span><span class="sybYZ">.</span><span class="scd8n">get</span><span class="sybYZ">(</span><span class="sVbU4">target</span><span class="sybYZ">,</span><span class="sVbU4"> p</span><span class="sybYZ">,</span><span class="sVbU4"> receiver</span><span class="sybYZ">)
</span></span><span class="line" line="12"><span class="sybYZ">      }
</span></span><span class="line" line="13"><span class="sybYZ">    },
</span></span><span class="line" line="14"><span class="scd8n">    set</span><span class="sybYZ">:</span><span class="sybYZ"> (</span><span class="sSfpy">target</span><span class="sybYZ">,</span><span class="sSfpy"> p</span><span class="sybYZ">,</span><span class="sSfpy"> newValue</span><span class="sybYZ">,</span><span class="sSfpy"> receiver</span><span class="sybYZ">)</span><span class="soRP2"> =&gt;</span><span class="sybYZ"> {
</span></span><span class="line" line="15"><span class="scBr_">      if</span><span class="sybYZ"> (</span><span class="sVbU4">p</span><span class="s8I54"> ===</span><span class="sajHj"> &#39;</span><span class="sx1Rn">sensitiveInfo</span><span class="sajHj">&#39;</span><span class="s8I54"> &amp;&amp;</span><span class="sVbU4"> role</span><span class="s8I54"> !==</span><span class="sajHj"> &#39;</span><span class="sx1Rn">admin</span><span class="sajHj">&#39;</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="16"><span class="scBr_">        throw</span><span class="s8I54"> new</span><span class="scd8n"> Error</span><span class="sybYZ">(</span><span class="sajHj">&#39;</span><span class="sx1Rn">Access Denied</span><span class="sajHj">&#39;</span><span class="sybYZ">)
</span></span><span class="line" line="17"><span class="sybYZ">      }
</span></span><span class="line" line="18"><span class="scBr_">      else</span><span class="sybYZ"> {
</span></span><span class="line" line="19"><span class="scBr_">        return</span><span class="sVbU4"> Reflect</span><span class="sybYZ">.</span><span class="scd8n">set</span><span class="sybYZ">(</span><span class="sVbU4">target</span><span class="sybYZ">,</span><span class="sVbU4"> p</span><span class="sybYZ">,</span><span class="sVbU4"> newValue</span><span class="sybYZ">,</span><span class="sVbU4"> receiver</span><span class="sybYZ">)
</span></span><span class="line" line="20"><span class="sybYZ">      }
</span></span><span class="line" line="21"><span class="sybYZ">    }
</span></span><span class="line" line="22"><span class="sybYZ">  })
</span></span><span class="line" line="23"><span class="sybYZ">}
</span></span><span class="line" line="24"><span emptylineplaceholder="true">
</span></span><span class="line" line="25"><span class="s8I54">const</span><span class="sXTEK"> admin</span><span class="soRP2"> =</span><span class="scd8n"> createSecureObject</span><span class="sybYZ">(</span><span class="sajHj">&#39;</span><span class="sx1Rn">admin</span><span class="sajHj">&#39;</span><span class="sybYZ">)
</span></span><span class="line" line="26"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">admin</span><span class="sybYZ">.</span><span class="sVbU4">sensitiveInfo</span><span class="sybYZ">)</span><span class="sKXKF"> // secret
</span></span><span class="line" line="27"><span emptylineplaceholder="true">
</span></span><span class="line" line="28"><span class="s8I54">const</span><span class="sXTEK"> user</span><span class="soRP2"> =</span><span class="scd8n"> createSecureObject</span><span class="sybYZ">(</span><span class="sajHj">&#39;</span><span class="sx1Rn">user</span><span class="sajHj">&#39;</span><span class="sybYZ">)
</span></span><span class="line" line="29"><span class="sVbU4">console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sVbU4">user</span><span class="sybYZ">.</span><span class="sVbU4">sensitiveInfo</span><span class="sybYZ">)</span><span class="sKXKF"> // Error: Access Denied
</span></span></code><!--]--></pre><h3 id="_3-面向切面编程"><a href="#_3-面向切面编程"><!--[-->3. 面向切面编程<!--]--></a></h3><p><!--[-->通过 Proxy 拦截函数,可以对函数的执行添加行为,例如计算函数执行消耗的时间<!--]--></p><pre class="language-js shiki shiki-themes github-dark vitesse-dark" style=""><!--[--><code><span class="line" line="1"><span class="s8I54">function</span><span class="scd8n"> calcFuncExecTime</span><span class="sybYZ">(</span><span class="sSfpy">func</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="2"><span class="scBr_">  return</span><span class="s8I54"> new</span><span class="scd8n"> Proxy</span><span class="sybYZ">(</span><span class="sVbU4">func</span><span class="sybYZ">,</span><span class="sybYZ"> {
</span></span><span class="line" line="3"><span class="scd8n">    apply</span><span class="sybYZ">(</span><span class="sSfpy">target</span><span class="sybYZ">,</span><span class="sSfpy"> thisArg</span><span class="sybYZ">,</span><span class="sSfpy"> args</span><span class="sybYZ">)</span><span class="sybYZ"> {
</span></span><span class="line" line="4"><span class="s8I54">      const</span><span class="sXTEK"> start</span><span class="soRP2"> =</span><span class="sVbU4"> performance</span><span class="sybYZ">.</span><span class="scd8n">now</span><span class="sybYZ">()
</span></span><span class="line" line="5"><span class="s8I54">      const</span><span class="sXTEK"> result</span><span class="soRP2"> =</span><span class="sVbU4"> Reflect</span><span class="sybYZ">.</span><span class="scd8n">apply</span><span class="sybYZ">(</span><span class="sVbU4">target</span><span class="sybYZ">,</span><span class="sVbU4"> thisArg</span><span class="sybYZ">,</span><span class="sVbU4"> args</span><span class="sybYZ">)
</span></span><span class="line" line="6"><span class="s8I54">      const</span><span class="sXTEK"> end</span><span class="soRP2"> =</span><span class="sVbU4"> performance</span><span class="sybYZ">.</span><span class="scd8n">now</span><span class="sybYZ">()
</span></span><span class="line" line="7"><span class="sVbU4">      console</span><span class="sybYZ">.</span><span class="scd8n">log</span><span class="sybYZ">(</span><span class="sajHj">`</span><span class="sx1Rn">function execution time </span><span class="sOPOU">${</span><span class="snnN9">(</span><span class="sGUJ0">end</span><span class="s8I54"> -</span><span class="sGUJ0"> start</span><span class="snnN9">).</span><span class="scd8n">toFixed</span><span class="snnN9">(</span><span class="svno3">3</span><span class="snnN9">)</span><span class="sOPOU">}</span><span class="sx1Rn">ms</span><span class="sajHj">`</span><span class="sybYZ">)
</span></span><span class="line" line="8"><span class="scBr_">      return</span><span class="sVbU4"> result
</span></span><span class="line" line="9"><span class="sybYZ">    }
</span></span><span class="line" line="10"><span class="sybYZ">  })
</span></span><span class="line" line="11"><span class="sybYZ">}
</span></span><span class="line" line="12"><span emptylineplaceholder="true">
</span></span><span class="line" line="13"><span class="s8I54">const</span><span class="sXTEK"> sum</span><span class="soRP2"> =</span><span class="scd8n"> calcFuncExecTime</span><span class="sybYZ">((</span><span class="sSfpy">a</span><span class="sybYZ">,</span><span class="sSfpy"> b</span><span class="sybYZ">)</span><span class="soRP2"> =&gt;</span><span class="sVbU4"> a</span><span class="s8I54"> +</span><span class="sVbU4"> b</span><span class="sybYZ">)
</span></span><span class="line" line="14"><span class="scd8n">sum</span><span class="sybYZ">(</span><span class="svno3">1</span><span class="sybYZ">,</span><span class="svno3"> 2</span><span class="sybYZ">)</span><span class="sKXKF"> // function execution time 0.043ms
</span></span></code><!--]--></pre><style>html pre.shiki code .s8I54, html code.shiki .s8I54{--shiki-default:#F97583;--shiki-dark:#CB7676}html pre.shiki code .sXTEK, html code.shiki .sXTEK{--shiki-default:#79B8FF;--shiki-dark:#BD976A}html pre.shiki code .soRP2, html code.shiki .soRP2{--shiki-default:#F97583;--shiki-dark:#666666}html pre.shiki code .scd8n, html code.shiki .scd8n{--shiki-default:#B392F0;--shiki-dark:#80A665}html pre.shiki code .sybYZ, html code.shiki .sybYZ{--shiki-default:#E1E4E8;--shiki-dark:#666666}html pre.shiki code .sVbU4, html code.shiki .sVbU4{--shiki-default:#E1E4E8;--shiki-dark:#BD976A}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sqmIX, html code.shiki .sqmIX{--shiki-default:#E1E4E8;--shiki-dark:#B8A965}html pre.shiki code .sajHj, html code.shiki .sajHj{--shiki-default:#9ECBFF;--shiki-dark:#C98A7D77}html pre.shiki code .sx1Rn, html code.shiki .sx1Rn{--shiki-default:#9ECBFF;--shiki-dark:#C98A7D}html pre.shiki code .svno3, html code.shiki .svno3{--shiki-default:#79B8FF;--shiki-dark:#4C9A91}html pre.shiki code .sSfpy, html code.shiki .sSfpy{--shiki-default:#FFAB70;--shiki-dark:#BD976A}html pre.shiki code .sOPOU, html code.shiki .sOPOU{--shiki-default:#9ECBFF;--shiki-dark:#4D9375}html pre.shiki code .sGUJ0, html code.shiki .sGUJ0{--shiki-default:#E1E4E8;--shiki-dark:#C98A7D}html pre.shiki code .scBr_, html code.shiki .scBr_{--shiki-default:#F97583;--shiki-dark:#4D9375}html pre.shiki code .sKXKF, html code.shiki .sKXKF{--shiki-default:#6A737D;--shiki-dark:#758575DD}html pre.shiki code .snnN9, html code.shiki .snnN9{--shiki-default:#9ECBFF;--shiki-dark:#666666}html pre.shiki code .smuiB, html code.shiki .smuiB{--shiki-default:#79B8FF;--shiki-dark:#CB7676}html pre.shiki code .s3iJD, html code.shiki .s3iJD{--shiki-default:#B392F0;--shiki-dark:#5DA994}html pre.shiki code .s_3qV, html code.shiki .s_3qV{--shiki-default:#79B8FF;--shiki-dark:#C99076}html pre.shiki code .sSBLT, html code.shiki .sSBLT{--shiki-default:#79B8FF;--shiki-dark:#4D9375}</style></article><div class="font-mono opacity-50 hover:opacity-90 cursor-pointer my-5"><span class="">&gt; </span><a href="/blog" class="">CD..</a></div><!--]--></div><!--]--><!--]--></div><div class="h-32"></div><footer class="limit py-8 text-sm text-dimmed text-center"><a href="https://beian.miit.gov.cn/" target="_blank" class="flex justify-center items-center gap-2"><span>蜀ICP备2023031823号</span><span>Powered by Seikonn</span></a></footer><!--]--><!--]--><!--[--><!--]--><!----><!--]--><!--[--><!--]--><!--]--><!--]--></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/blog/202504/understand-proxy-and-reflcet/_payload.json?5753449a-b371-4a7b-929f-a15eaee77566">[{"state":1,"once":8,"_errors":9,"serverRendered":5,"path":11,"prerenderedAt":12},["Reactive",2],{"$scolor-mode":3,"$stoasts":7},{"preference":4,"value":4,"unknown":5,"forced":6},"system",true,false,[],["Set"],["ShallowReactive",10],{"/blog/202504/understand-proxy-and-reflcet":-1},"/blog/202504/understand-proxy-and-reflcet",1746758021245]</script><script>window.__NUXT__={};window.__NUXT__.config={public:{content:{wsUrl:""},mdc:{components:{prose:true,map:{}},headings:{anchorLinks:{h1:false,h2:true,h3:true,h4:true,h5:false,h6:false}}},preview:{api:"https://api.nuxt.studio",iframeMessagingAllowedOrigins:""}},app:{baseURL:"/",buildId:"5753449a-b371-4a7b-929f-a15eaee77566",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>